define(["spinner-template","spinner-model","limit-textbox"],function(t,e,i){"use strict"
var n=Backbone.View.extend({minValue:null,maxValue:null,stepValue:null,spinValue:null,spinSign:!1,upBtn:null,downBtn:null,disableSpin:!1,previousValue:"",currentValue:"",isEditable:!1,alignType:!1,inputPrecision:null,inputRegEx:null,spinnerTextbox:null,isFocusedPress:!1,buttonWidth:null,buttonHeight:null,inputBoxWidth:null,inputBoxHeight:null,initialize:function(){var t,e,i=this.model,n=43,s=31,l=39,a=39
this.spinBoxId=i.get("spinId"),this.minValue=i.get("minValue"),this.maxValue=i.get("maxValue"),this.stepValue=i.get("step"),this.buttonWidth=n,this.buttonHeight=s,this.inputBoxWidth=a,this.inputBoxHeight=l,this.spinValue=i.get("defaultValue"),this.spinSign=i.get("showSign"),this.isEditable=i.get("isEditable"),this.allValues=i.get("allValues"),t={spinBoxId:this.spinBoxId},e=Handlebars.templates["spinner-template"]({spinBoxId:this.spinBoxId}),this._render(e),this._attachEvents(),this.$(".textbox-field").on("focusout",_.bind(this._takeValueFromTextfield,this)),this.updateSpinValue(this.spinValue),this.isEditable?this.$(".textbox-field").removeAttr("disabled"):this.$(".textbox-field").attr("disabled","disabled")},_render:function(t){this.$el.append(t.trim()),this.$(".spin-textbox-container,.spin-down-arrow,.spin-up-arrow").addClass("center-aligned"),this.$(".textbox-field").width(this.inputBoxWidth)
var e=new i({el:this.$(".textbox-field"),option:{minInput:this.minValue,maxInput:this.maxValue,allowMinus:!0,onlyPositiveDecimal:!0}})
e.on("empty-textbox-field-value",_.bind(this.emptyTextBoxFieldValue,this)),this.model.set("limitTextboxView",e)},emptyTextBoxFieldValue:function(){this.$(".textbox-field").val(this.currentValue.safe_toFixed(this.model.get("inputPrecision")))},_attachEvents:function(){var t=this.$(".arrowbutton-container.up"),e=this.$(".arrowbutton-container.down")
this.upBtn=t,this.downBtn=e,this.$(".textbox-field").off("keypress.textBoxField").on("keypress.textBoxField",_.bind(this._onKeyPress,this)),e.hasClass("disabled")?e.off("click.spinBoxDownButton").off("mouseenter.spinBoxDownButton").off("mouseleave.spinBoxDownButton"):(e.off("click.spinBoxDownButton").on("click.spinBoxDownButton",_.bind(this._spinDownButttonClick,this)),"ontouchstart"in window==!1&&e.off("mouseenter.spinBoxDownButton").on("mouseenter.spinBoxDownButton",_.bind(this._hoverState,this)).off("mouseleave.spinBoxDownButton").on("mouseleave.spinBoxDownButton",_.bind(this._removeHoverState,this))),t.hasClass("disabled")?t.off("click.spinBoxUpButton").off("mouseenter.spinBoxUpButton").off("mouseleave.spinBoxUpButton"):(t.off("click.spinBoxUpButton").on("click.spinBoxUpButton",_.bind(this._spinUpButttonClick,this)),"ontouchstart"in window==!1&&t.off("mouseenter.spinBoxUpButton").on("mouseenter.spinBoxUpButton",_.bind(this._hoverState,this)).off("mouseleave.spinBoxUpButton").on("mouseleave.spinBoxUpButton",_.bind(this._removeHoverState,this)))},_valueChanged:function(){this.trigger("data-value-changed")},_onKeyPress:function(t){if(t.keyCode===n.CODE.ENTER_KEY){var e=this.maxValue,i=this.minValue,s=this.$(".textbox-field"),l=s.val()
i>l?s.val(i):l>e&&s.val(e),this._takeValueFromTextfield()}},_hoverState:function(t){var e=$(t.currentTarget)
0===e.find(".arrowbutton.disabled").length&&e.addClass("hover")},_removeHoverState:function(t){$(t.currentTarget).removeClass("hover")},_downState:function(t){var e=$(t.currentTarget)
0===e.find(".arrowbutton.disabled").length&&e.addClass("btn-down")},_removeDownState:function(t){$(t.currentTarget).removeClass("btn-down")},updateSpinValue:function(t,e,i){var n=this.model.get("defaultText")
return this.previousValue=this.currentValue,e&&(this.allValues||null===this.allValues)&&(t=null===this.allValues?null:this.allValues[t-2]),this.previousValue===t?void this.$(".textbox-field").val(t.safe_toFixed(this.model.get("inputPrecision"))):(this.disableSpin||(null===t||t===n?(this.$(".textbox-field").val(n.safe_toFixed(this.model.get("inputPrecision"))),this.currentValue=null):(this.$(".textbox-field").val(t.safe_toFixed(this.model.get("inputPrecision"))),this.currentValue=t),this.model.get("limitTextboxView").inputLastVal=this.currentValue,this.minValue===t?($(this.upBtn).hasClass("disabled")&&this._enableBtn(this.upBtn),this._disableBtn(this.downBtn),this._attachEvents()):this.maxValue===t?(this._disableBtn(this.upBtn),$(this.downBtn).hasClass("disabled")&&this._enableBtn(this.downBtn),this._attachEvents()):($(this.upBtn).hasClass("disabled")&&this._enableBtn(this.upBtn),$(this.downBtn).hasClass("disabled")&&null!==this.currentValue&&this._enableBtn(this.downBtn),this._attachEvents()),null===this.currentValue&&(this._disableBtn(this.downBtn),this._disableBtn(this.upBtn))),void(i||this._valueChanged()))},_takeValueFromTextfield:function(){var t=this.$(".textbox-field").val(),e=Number(t)
e>this.maxValue?(this.$(".textbox-field").val(this.maxValue.safe_toFixed(this.model.get("inputPrecision"))),e=Number(this.$(".textbox-field").val())):(isNaN(e)||""===t)&&(e=this.currentValue),this.updateSpinValue(e)},_spinUpButttonClick:function(t){if(!($(t.currentTarget).hasClass("disabled")||void 0!==t&&void 0!==t.which&&1!==t.which)){var e,i=this.stepValue,n=this.stepValue.toString(),s=n.length-n.indexOf(".")-1,l=Number(this.currentValue)
this.allValues?(e=this.allValues.indexOf(l),l=-1===e?this.roundToNearestValue(l)[0]:this.allValues[--e]):l+=i,this.updateSpinValue(Number(l.toFixed(s)))}},_spinDownButttonClick:function(t){if(!($(t.currentTarget).hasClass("disabled")||"undefined"!=typeof t&&"undefined"!=typeof t.which&&1!==t.which)){var e,i=Number(this.currentValue),n=this.stepValue.toString(),s=n.length-n.indexOf(".")-1
this.allValues?(e=this.allValues.indexOf(i),i=-1===e?this.roundToNearestValue(i)[1]:this.allValues[++e]):i-=this.stepValue,this.updateSpinValue(Number(i.toFixed(s)))}},_spinUpButttonPress:function(){var t,e=this.stepValue,i=Number(this.currentValue)
this.allValues?(t=this.allValues.indexOf(i),i=-1===t?this.roundToNearestValue(i)[0]:this.allValues[--t]):i+=e,this.updateSpinValue(i)},_spinDownButttonPress:function(){var t,e=Number(this.currentValue)
this.allValues?(t=this.allValues.indexOf(e),e=-1===t?this.roundToNearestValue(e)[1]:this.allValues[++t]):e-=this.stepValue,this.updateSpinValue(e)},roundToNearestValue:function(t){for(var e,i=-1,n=this.allValues,s=n.length;s-i>1;)e=Math.round((i+s)/2),n[e]>=t?i=e:s=e
return n[i]===t?n[i]:[n[i],n[s]]},updateSpinnerDefaults:function(t){var e,i
this.allValues&&(e=this.allValues.indexOf(this.currentValue)),(-1===e||void 0===e)&&(e=1),this.allValues=t.intervalArray,this.maxValue=t.maxValue,this.minValue=t.minValue,this.defaultValue=t.defaultValue,this.model.get("limitTextboxView").maxInput=t.maxValue,this.model.get("limitTextboxView").minInput=t.minValue,this.model.set({maxValue:this.maxValue,minValue:this.minValue,defaultValue:this.defaultValue}),this.allValues?(i=this.allValues[e],null===this.currentValue&&(this._enableBtn(this.downBtn),this._enableBtn(this.upBtn))):(i=null,this._disableBtn(this.downBtn),this._disableBtn(this.upBtn)),this._attachEvents(),this.currentValue=i,this.$(".textbox-field").val(i.safe_toFixed(this.model.get("inputPrecision")))},_enableBtn:function(t){t.removeClass("disabled"),t.find(".arrowbutton").removeClass("disabled")},_disableBtn:function(t){t.addClass("disabled"),t.find(".arrowbutton").addClass("disabled").closest(".arrowbutton-container").removeClass("hover")},events:{"focusout .spinbox .spinner-input-box":"_spinBoxInputFocusOut","focusin .spinbox .spinner-input-box":"_spinBoxInputFocusIn","keyup .spinbox .spinner-input-box":"_spinBoxInputKeyPress"},setFocusOnSpinner:function(){this.$(".textbox-field").focus()},getModel:function(){return this.model}},{generateCustomSpinner:function(t){if(t){var i=new e(t),s=new n({model:i,el:t.el})
return s}},CODE:{LEFT_ARROW_KEY:37,RIGHT_ARROW_KEY:39,UP_ARROW_KEY:38,DOWN_ARROW_KEY:40,BACKSPACE_KEY:8,ENTER_KEY:13,DELETE_KEY:46,ZERO_KEY:48,NINE_KEY:57}})
return n})
