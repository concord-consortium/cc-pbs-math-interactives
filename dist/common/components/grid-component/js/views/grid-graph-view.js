!function(){"use strict"
GridGraphComponent.Views.GridView=Backbone.View.extend({pixiGraphics:null,pixiRenderer:null,isOriginVisible:!1,drawShapesObj:null,_lastViewRefresh:null,_refreshTimer:null,initialize:function(){this.render()},render:function(){return this._resetGridGraph(),this},_resetGridGraph:function(){this._createPixiRenderer(),this.isOriginVisible=this.model.isPointVisible({x:0,y:0}),this._plotGridLines(),this._plotAxes(),this._bindInterctionEvents(),this._refreshGridGraph()},_refreshGridGraph:function(){var e,i=(new Date).getTime(),t=50
if(this._lastViewRefresh&&(e=i-this._lastViewRefresh),e&&t>e){if(this._refreshTimer)return
return void(this._refreshTimer=setInterval($.proxy(this._refreshGridGraph,this),t-e))}this._refreshTimer&&(clearInterval(this._refreshTimer),this._refreshTimer=null),this._lastViewRefresh=i,this.pixiRenderer.render(this.pixiGraphics)},_createPixiRenderer:function(){this.pixiRenderer&&(this.$el.empty(),this.pixiGraphics.destroy(),this.pixiRenderer.destroy(),this.pixiGraphics=this.pixiRenderer=this.drawShapesObj=null),this.pixiGraphics=new PIXI.Graphics,this.pixiRenderer=new PIXI.CanvasRenderer(this.model.get("canvasWidth"),this.model.get("canvasHeight"),{backgroundColor:this.model.get("backgroundColor"),antialias:!0}),this.pixiRenderer.view.className="grid-graph-canvas",this.pixiGraphics.interactive=!0,this.pixiGraphics.hitArea=new PIXI.Rectangle(0,0,this.pixiRenderer.width,this.pixiRenderer.height),this.drawShapesObj=new ShapesComponent.DrawShapes({pixiRenderer:this.pixiRenderer,pixiGraphics:this.pixiGraphics}),this.$el.html(this.pixiRenderer.view)},_bindInterctionEvents:function(){var e=ShapesComponent.DrawShapes.PRIMITIVE_SHAPE_EVENTS
this.pixiGraphics.mouseover=$.proxy(function(e){this._onMouseOver(e)},this),this.pixiGraphics.mousedown=$.proxy(function(e){this._onMouseDown(e),this.pixiGraphics.mousemove=null,this.pixiGraphics.mousemove=$.proxy(function(e){this._onMouseMove(e)},this)},this),this.pixiGraphics.mouseup=$.proxy(function(e){this._onMouseUp(e),this.pixiGraphics.mousemove=null},this),this.pixiGraphics.mouseout=$.proxy(function(e){this._onMouseOut(e)},this),this.pixiGraphics.touchstart=$.proxy(function(e){this._onTouchStart(e),this.pixiGraphics.touchmove=null,this.pixiGraphics.touchmove=$.proxy(function(e){this._onTouchMove(e)},this)},this),this.pixiGraphics.touchend=$.proxy(function(e){this._onTouchEnd(e),this.pixiGraphics.touchmove=null},this),$(this.drawShapesObj).off(e.SHAPE_MOUSEOVER).on(e.SHAPE_MOUSEOVER,$.proxy(function(i,t,r){this.trigger(e.SHAPE_MOUSEOVER,t,r)},this)),$(this.drawShapesObj).off(e.SHAPE_MOUSEDOWN).on(e.SHAPE_MOUSEDOWN,$.proxy(function(i,t,r){this.trigger(e.SHAPE_MOUSEDOWN,t,r)},this)),$(this.drawShapesObj).off(e.SHAPE_MOUSEOUT).on(e.SHAPE_MOUSEOUT,$.proxy(function(i,t,r){this.trigger(e.SHAPE_MOUSEOUT,t,r)},this)),$(this.drawShapesObj).off(e.SHAPE_MOUSEUP).on(e.SHAPE_MOUSEUP,$.proxy(function(i,t,r){this.trigger(e.SHAPE_MOUSEUP,t,r)},this))},_onMouseMove:function(e){var i=e.data.global,t=null
e.target.hitArea.contains(i.x,i.y)&&(t=this.model.convertToGraphCoordinates(i),this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_MOUSEMOVE,t,i))},_onMouseOver:function(e){var i=e.data.global,t=this.model.convertToGraphCoordinates(i)
this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_MOUSEOVER,t,i)},_onMouseDown:function(e){var i=e.data.global,t=this.model,r=t.mainModel,o=t.convertToGraphCoordinates(i)
this.model.mainModel.selectedLine&&(this.model.mainModel.selectedLine.deselectLine(),this.model.mainModel.trigger("OnDeselectLine",{})),r.idSelectedEqPanel!==r.constants.INVALID_VALUE&&r.trigger("onDeselectingEquationPanel",{eqPanelId:r.idSelectedEqPanel}),r.idSelectedEqPanel=r.constants.INVALID_VALUE,this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_MOUSEDOWN,o,i)},_onMouseUp:function(e){var i=e.data.global,t=this.model.convertToGraphCoordinates(i)
this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_MOUSEUP,t,i)},_onMouseOut:function(e){var i=e.data.global,t=this.model.convertToGraphCoordinates(i)
this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_MOUSEOUT,t,i)},_onTouchStart:function(e){var i=e.data.global,t=this.model,r=t.mainModel,o=t.convertToGraphCoordinates(i)
this.model.mainModel.selectedLine&&(this.model.mainModel.selectedLine.deselectLine(),this.model.mainModel.trigger("OnDeselectLine",{})),r.idSelectedEqPanel!==r.constants.INVALID_VALUE&&r.trigger("onDeselectingEquationPanel",{eqPanelId:r.idSelectedEqPanel}),r.idSelectedEqPanel=r.constants.INVALID_VALUE,this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_TOUCHSTART,o,i)},_onTouchEnd:function(e){var i=e.data.global,t=this.model.convertToGraphCoordinates(i)
this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_TOUCHEND,t,i)},_onTouchMove:function(e){var i=e.data.global,t=this.model.convertToGraphCoordinates(i)
this.trigger(GridGraphComponent.Views.GridView.GRAPH_EVENTS_NAMESPACE.GRID_GRAPH_TOUCHMOVE,t,i)},_plotAxes:function(){if(this.isOriginVisible&&this.model.get("showAxes")){var e=this.model.get("canvasOrigin"),i=this.model.get("canvasWidth"),t=this.model.get("canvasHeight")
this.pixiGraphics.beginFill().lineStyle(2,this.model.get("gridAxesColor"),1).moveTo(0,e.y).lineTo(i,e.y).moveTo(e.x,0).lineTo(e.x,t).endFill()}},_plotGridLines:function(){var e,i,t=this.model.get("gridLimits"),r=this.model.get("xInterval"),o=this.model.get("yInterval"),s=this.model.get("canvasWidth"),n=(this.model.get("canvasHeight"),this.model.getNearestMultipleOfInterval(t.xLower,r)),h=this.model.getNearestMultipleOfInterval(t.yLower,o),a=this.model.get("canvasOrigin"),d=this.model.get("showGridLines"),l=this.model.get("showIntervalLabels"),p={font:this.model.get("labelsFontSize")+" "+this.model.get("labelsFontFamily"),fill:this.model.get("labelsFontColor")},c=n,G=h,u=this.model.get("gridLinesColor"),m=this.model.get("gridLinesAlpha")
if(this.pixiGraphics.beginFill(u,m).lineStyle(1,u,m),d){for(;n<=t.xUpper;)this._drawLine({x:n,y:t.yLower},{x:n,y:t.yUpper}),n+=r
for(;h<=t.yUpper;)this._drawLine({x:t.xLower,y:h},{x:t.xUpper,y:h}),h+=o}if(l){for(this.isOriginVisible?e=i=0:(e=a.x>=s?t.xUpper:t.xLower,i=a.y<=0?t.yUpper:t.yLower);c<=t.xUpper;)0!==c&&this._createAndAddTextLabelObject(c,{x:c,y:i},p,!0),c+=r
for(;G<=t.yUpper;)0!==G&&this._createAndAddTextLabelObject(G,{x:e,y:G},p,!1),G+=o}this.pixiGraphics.endFill()},_createAndAddTextLabelObject:function(e,i,t,r){var o=new PIXI.Text(e,t),s=this.model.convertToCanvasCoordinates(i),n=this._getXAdjust(s.x,o,r),h=this._getYAdjust(s.y,o,r),a=new PIXI.Point(s.x-n,s.y-h)
return o.position=a,this.pixiGraphics.addChild(o),o},createAxesLabels:function(e,i){var t={font:this.model.get("labelsFontSize")+" "+this.model.get("labelsFontFamily"),fill:this.model.get("labelsFontColor")},r=new PIXI.Text(e,t),o=new PIXI.Text(i,t),s=new PIXI.Point(195-r.width/2,375),n=new PIXI.Point(0,195+o.width/2)
return r.position=s,o.position=n,o.rotation=-90*Math.PI/180,this.pixiGraphics.addChild(r),this.pixiGraphics.addChild(o),this._refreshGridGraph(),{textObjXAxis:r,textObjYAxis:o}},createSliderPointCoords:function(e){var i={font:this.model.get("labelsFontSize")+" "+this.model.get("labelsFontFamily"),fill:this.model.get("labelsFontColor")},t=new PIXI.Text("("+e.x.toFixed(1)+", "+e.y.toFixed(1)+")",i),r=this.model.convertToCanvasCoordinates(e),o=this._getXAdjust(r.x,t,!0),s=(this._getYAdjust(r.y,t,!0),new PIXI.Point(r.x+o/2,r.y-t.height/2))
return t.position=s,this.pixiGraphics.addChild(t),this._refreshGridGraph(),t},_getXAdjust:function(e,i,t){var r=i.getBounds().width
return t?e+r>this.model.get("canvasWidth")?r:0>e-r/2?0:r/2:0>e-r?0:r},_getYAdjust:function(e,i,t){var r=i.getBounds().height
return e+r>this.model.get("canvasHeight")?r:t?0:0>e-r/2?0:r/2},_drawLine:function(e,i){if(this.model.isPointVisible(e)||this.model.isPointVisible(i)){var t=this.model.convertToCanvasCoordinates(e),r=this.model.convertToCanvasCoordinates(i)
return this.pixiGraphics.moveTo(t.x,t.y).lineTo(r.x,r.y),!0}return!1},changeBackgroundColor:function(e,i){this.model.set("backgroundColor",e),i&&this._resetGridGraph()},changeGridLinesColor:function(e,i){this.model.set("gridLinesColor",e),i&&this._resetGridGraph()},changeLabelsColor:function(e,i){this.model.set("labelsFontColor",e),i&&this._resetGridGraph()},changeGridAxesColor:function(e,i){this.model.set("gridAxesColor",e),i&&this._resetGridGraph()},changeCanvasHeight:function(e,i){this.model.set("canvasHeight",e),i&&this._resetGridGraph()},changeCanvasWidth:function(e,i){this.model.set("canvasWidth",e),i&&this._resetGridGraph()},changeXInterval:function(e,i){this.model.set("xInterval",e),i&&this._resetGridGraph()},changeYInterval:function(e,i){this.model.set("yInterval",e),i&&this._resetGridGraph()},showHideAxes:function(e,i){this.model.set("showAxes",e),i&&this._resetGridGraph()},showHideGridLines:function(e,i){this.model.set("showGridLines",e),i&&this._resetGridGraph()},showHideIntervalLabels:function(e,i){this.model.set("showIntervalLabels",e),i&&this._resetGridGraph()},setGridLimits:function(e,i){var t=this.model.get("gridLimits"),r=e.xLower||t.xLower,o=e.xUpper||t.xUpper,s=e.yLower||t.yLower,n=e.yUpper||t.yUpper,h={xLower:Number(r),xUpper:Number(o),yLower:Number(s),yUpper:Number(n)}
this.model.set("gridLimits",h),i&&this._resetGridGraph()},addPointToGraph:function(e,i,t,r,o,s){var n=this.snapPointToGrid(e,o),h=this.model.convertToCanvasCoordinates(n),a=this.drawShapesObj.plotPoint({canvasCoord:h,fillColor:i,lineColor:t,radius:r,graphCoord:n,pointType:s})
return a},addLineToGraph:function(e,i,t,r,o){var s=this.model.convertToCanvasCoordinates(e),n=this.model.convertToCanvasCoordinates(i),h=this.drawShapesObj.plotLine({canvasCoord1:s,canvasCoord2:n,lineColor:t,lineWidth:r,lineType:o})
return h},moveLineEnd:function(e,i){var t=this.model.convertToCanvasCoordinates(i)
this.drawShapesObj.moveLineEnd(e,t)},bringToFront:function(e){this.drawShapesObj.bringToFront(e)},snapPointToGrid:function(e,i){if(!i)return e
var t={x:GridGraphComponent.Models.GridModel.roundNumber(e.x),y:GridGraphComponent.Models.GridModel.roundNumber(e.y)},r=this.model.get("xInterval"),o=this.model.get("yInterval"),s=GridGraphComponent.Models.GridModel.roundNumber(t.x/r)*r,n=GridGraphComponent.Models.GridModel.roundNumber(t.y/o)*o
return t={x:s,y:n}}},{createGridGraph:function(e){if(!e.containerId)return void console.log("PLEASE PROVIDE CONTAINER ID FOR GRAPH")
var i="#"+e.containerId,t=new GridGraphComponent.Models.GridModel(e),r=new GridGraphComponent.Views.GridView({model:t,el:i})
return r},GRAPH_EVENTS_NAMESPACE:GridGraphComponent.Models.GridModel.GRAPH_EVENTS})}(GridGraphComponent)
