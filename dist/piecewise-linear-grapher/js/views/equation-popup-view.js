define(["equation-popup-template","lang-json","constants","spinner-view"],function(e,n,t,p){var s=Backbone.View.extend({initialize:function(e){this.bSpinnersCreated=!1,this.constants=new t,this.affectedExpData=null,this.bIsVisible=!1,this.listenTo(this.model,"OnLineDatachange",this.OnLineDatachange),this.listenTo(this.model,"OnPopupVisibilityChange",this.OnPopupVisibilityChange),this.langJson=n,this.accJson=n.popupAccJSON,this.accManager=e.accManager,this.bIsPopupAlreadyOpen=!1,this.render()},OnPopupVisibilityChange:function(e){e.bIsVisible===!1&&(this.bIsPopupAlreadyOpen=e.bIsVisible)},setAccOn:function(){for(var e,n=this.accJson.length,t=0,p=null,s=this.model.EqPanelData[this.affectedExpData.EqPanelId].lineData[this.affectedExpData.LineId];n>t;t++){e=this.accJson[t],this.accManager.setTabIndex(this.$(e.id),e.tabIndex)
var p=null
if("#plg-eqn-popup-holder"===e.id){var i="Segment"
s.lineTypeId===this.constants.POS_INFINITY_RAY?i="positive ray":s.lineTypeId===this.constants.NEG_INFINITY_RAY&&(i="negative ray"),p=[i,Object.keys(this.model.EqPanelData[this.affectedExpData.EqPanelId].lineData).indexOf(this.affectedExpData.LineId)+1]}else if("#fa-check-square-label1"===e.id){var a="The function is in the point slope form. Use spacebar to select the slope intercept form."
this.$("#fa-check-square-label1").hasClass("checked")&&(a="The function is in the slope intercept form."),p=[a]}else if("#plg-eqn-popup-11"===e.id||"#plg-eqn-popup-21"===e.id){var l=s.slope
l=l.toFixed(2),p=[l]}else if("#plg-eqn-popup-12"===e.id){var o=s.displacement
o=o.toFixed(1),p=[o]}else if("#plg-eqn-popup-13"===e.id||"#plg-eqn-popup-24"===e.id){if(s.lineTypeId===this.constants.POS_INFINITY_RAY||s.lineTypeId===this.constants.SEGMENT){var h=s.x1
h=h.toFixed(1),p=[h]}else if(s.lineTypeId===this.constants.NEG_INFINITY_RAY)continue}else if("#plg-eqn-popup-13-infinitytext"===e.id||"#plg-eqn-popup-24-infinitytext"===e.id){if(s.lineTypeId===this.constants.POS_INFINITY_RAY||s.lineTypeId===this.constants.SEGMENT)continue}else if("#plg-eqn-popup-toggle-btn-base-one"===e.id||"#plg-eqn-popup-toggle-btn-base-three"===e.id){var c,g
this.$("#plg-eqn-popup-toggle-btn-less-than-equal-one").hasClass("plg-eqn-popup-toggle-checked")?(c="less than or equal to",g="less than"):(c="less than",g="less than or equal to"),p=[c,g]}else if("#plg-eqn-popup-toggle-btn-base-two"===e.id||"#plg-eqn-popup-toggle-btn-base-four"===e.id){var c,g
this.$("#plg-eqn-popup-toggle-btn-less-than-equal-two").hasClass("plg-eqn-popup-toggle-checked")?(c="less than or equal to",g="less than"):(c="less than",g="less than or equal to"),p=[c,g]}else if("#plg-eqn-popup-14"===e.id||"#plg-eqn-popup-25"===e.id){if(s.lineTypeId===this.constants.NEG_INFINITY_RAY||s.lineTypeId===this.constants.SEGMENT){var u=s.x2
u=u.toFixed(1),p=[u]}else if(s.lineTypeId===this.constants.POS_INFINITY_RAY)continue}else if("#plg-eqn-popup-14-infinitytext"===e.id||"#plg-eqn-popup-25-infinitytext"===e.id){if(s.lineTypeId===this.constants.NEG_INFINITY_RAY||s.lineTypeId===this.constants.SEGMENT)continue}else if("#fa-check-square-label2"===e.id){var a="The function is in the slope intercept form. Use spacebar to select the point slope form."
this.$("#fa-check-square-label2").hasClass("checked")&&(a="The function is in the point slope form."),p=[a]}else if("#plg-eqn-popup-22"===e.id){var r=s.x2;(s.lineTypeId===this.constants.POS_INFINITY_RAY||s.lineTypeId===this.constants.SEGMENT)&&(r=s.x1),r=r.toFixed(1),p=[r]}else if("#plg-eqn-popup-23"===e.id){var d=s.y2;(s.lineTypeId===this.constants.POS_INFINITY_RAY||s.lineTypeId===this.constants.SEGMENT)&&(d=s.y1),d=d.toFixed(1),p=[d]}this.accManager.setAccText(this.$(e.id),e.accText,p)}this.$(".acc-element").on("keydown",_.bind(this.accManager._keyPressHandler,this))},setAccOff:function(){for(var e,n=this.accJson.length,t=0;n>t;t++)e=this.accJson[t],this.accManager.setTabIndex(this.$(e.id),-1),this.accManager.setAccText(this.$(e.id),"",null)
this.$(".acc-element").on("keydown",_.bind(this.accManager._keyPressHandler,this))},setAffectedExpData:function(e){this.affectedExpData=e,this.bIsVisible=!0},OnLineDatachange:function(e){this.bIsVisible===!0&&this.updateRender(),null!=this.accManager&&this.accManager.isAccessibilityOn&&(this.bIsVisible===!0?(this.setAccOn(),this.bIsPopupAlreadyOpen||(this.$("#plg-eqn-popup-holder").focus(),this.bIsPopupAlreadyOpen=!0)):this.setAccOff())},events:{"click .plg-eqn-popup-checkbox":"checkPopupCheckBox","click .plg-eqn-slope-label":"checkPopupCheckBox","click #plg-eqn-popup-toggle-btn-base-one , #plg-eqn-popup-toggle-btn-base-three":"CheckToggleLeftRange","click #plg-eqn-popup-toggle-btn-base-two , #plg-eqn-popup-toggle-btn-base-four":"CheckToggleRightRange","keyup #plg-eqn-popup-11":"popupChangeUpDownKeySlopeSI","keyup #plg-eqn-popup-12":"popupChangeUpDownKeyDisplacementSI","keyup #plg-eqn-popup-13":"popupChangeUpDownKeyX1SI","keyup #plg-eqn-popup-14":"popupChangeUpDownKeyX2SI","keyup #plg-eqn-popup-21":"popupChangeUpDownKeySlopePS","keyup #plg-eqn-popup-22":"popupChangeUpDownKeyX1APS","keyup #plg-eqn-popup-23":"popupChangeUpDownKeyY1PS","keyup #plg-eqn-popup-24":"popupChangeUpDownKeyX1BPS","keyup #plg-eqn-popup-25":"popupChangeUpDownKeyX2PS","keyup #plg-eqn-popup-holder":"popupHolderKeyup"},popupHolderKeyup:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
27===n&&this.showPopup(!1)}},popupChangeUpDownKeySlopeSI:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.si_spinner_slope._spinUpButttonPress():40===n&&this.si_spinner_slope._spinDownButttonPress()}},popupChangeUpDownKeyDisplacementSI:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.si_spinner_displacement._spinUpButttonPress():40===n&&this.si_spinner_displacement._spinDownButttonPress()}},popupChangeUpDownKeyX1SI:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.si_spinner_x1._spinUpButttonPress():40===n&&this.si_spinner_x1._spinDownButttonPress()}},popupChangeUpDownKeyX2SI:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.si_spinner_x2._spinUpButttonPress():40===n&&this.si_spinner_x2._spinDownButttonPress()}},popupChangeUpDownKeySlopePS:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.ps_spinner_slope._spinUpButttonPress():40===n&&this.ps_spinner_slope._spinDownButttonPress()}},popupChangeUpDownKeyX1APS:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.ps_spinner_x1_a._spinUpButttonPress():40===n&&this.ps_spinner_x1_a._spinDownButttonPress()}},popupChangeUpDownKeyY1PS:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.ps_spinner_y1._spinUpButttonPress():40===n&&this.ps_spinner_y1._spinDownButttonPress()}},popupChangeUpDownKeyX1BPS:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.ps_spinner_x1_b._spinUpButttonPress():40===n&&this.ps_spinner_x1_b._spinDownButttonPress()}},popupChangeUpDownKeyX2PS:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var n=e.keyCode||e.which
38===n?this.ps_spinner_x2._spinUpButttonPress():40===n&&this.ps_spinner_x2._spinDownButttonPress()}},CheckToggleLeftRange:function(){var e=this.constants.LESS_THAN_OR_EQUAL
this.$("#plg-eqn-popup-toggle-btn-less-than-equal-one").hasClass("plg-eqn-popup-toggle-checked")&&(e=this.constants.LESS_THAN),this.model.ChangeToggleLeftRange({affectedExpData:this.affectedExpData,ChangedToggleLeftRangeType:e})},CheckToggleRightRange:function(){var e=this.constants.LESS_THAN_OR_EQUAL
this.$("#plg-eqn-popup-toggle-btn-less-than-equal-two").hasClass("plg-eqn-popup-toggle-checked")&&(e=this.constants.LESS_THAN),this.model.CheckToggleRightRange({affectedExpData:this.affectedExpData,ChangedToggleRightRangeType:e})},checkPopupCheckBox:function(e){var n=this.constants.POINT_SLOPE
this.$(e.currentTarget).hasClass("one")&&(n=this.constants.SLOPE_INTERCEPT),this.model.ChangeInterceptType({affectedExpData:this.affectedExpData,ChangedInterceptType:n})},render:function(){var e=Handlebars.templates["equation-popup-template"]({}).trim()
this.spinnerMinValue=-10,this.spinnerMaxValue=10,this.$el.append(e),this.$("#plg-eqn-slope-label-1").html(this.langJson.slope_label_1),this.$("#plg-eqn-slope-label-2").html(this.langJson.slope_label_2),this.$(".variableX").html(this.langJson.Variable_X),this.$(".forText").html(this.langJson.FOR),this.$(".plus").html(this.langJson.PLUS),this.$(".minus").html(this.langJson.MINUS),this.$(".plg-eqn-popup-13-infinitytext").html(this.langJson.NegInfinityText),this.$(".plg-eqn-popup-24-infinitytext").html(this.langJson.NegInfinityText),this.$(".plg-eqn-popup-14-infinitytext").html(this.langJson.InfinityText),this.$(".plg-eqn-popup-25-infinitytext").html(this.langJson.InfinityText),this.si_spinner_slope=this.createSpinner("plg-eqn-popup-11",.01,1,"spinBox11",2),this.si_spinner_displacement=this.createSpinner("plg-eqn-popup-12",.1,2,"spinBox12",1),this.si_spinner_x1=this.createSpinner("plg-eqn-popup-13",.1,3,"spinBox13",1),this.si_spinner_x2=this.createSpinner("plg-eqn-popup-14",.1,4,"spinBox14",1),this.ps_spinner_slope=this.createSpinner("plg-eqn-popup-21",.01,1,"spinBox11",2),this.ps_spinner_x1_a=this.createSpinner("plg-eqn-popup-22",.1,2,"spinBox22",1),this.ps_spinner_y1=this.createSpinner("plg-eqn-popup-23",.1,3,"spinBox23",1),this.ps_spinner_x1_b=this.createSpinner("plg-eqn-popup-24",.1,4,"spinBox24",1),this.ps_spinner_x2=this.createSpinner("plg-eqn-popup-25",.1,5,"spinBox25",1),this.listenTo(this.si_spinner_slope,"data-value-changed",this.changeSIspinnerSlope),this.listenTo(this.si_spinner_displacement,"data-value-changed",this.changeSIspinnerDisplacement),this.listenTo(this.si_spinner_x1,"data-value-changed",this.changeSIspinnerX1),this.listenTo(this.si_spinner_x2,"data-value-changed",this.changeSIspinnerX2),this.listenTo(this.ps_spinner_slope,"data-value-changed",this.changePSspinnerSlope),this.listenTo(this.ps_spinner_x1_a,"data-value-changed",this.changePSspinnerX1A),this.listenTo(this.ps_spinner_y1,"data-value-changed",this.changePSspinnerY1),this.listenTo(this.ps_spinner_x1_b,"data-value-changed",this.changePSspinnerX1B),this.listenTo(this.ps_spinner_x2,"data-value-changed",this.changePSspinnerX2),this._attachEvents(),this.showPopup(!1)},updateRender:function(){var e="plg-eqn-popup-label plg-eqn-popup-label-"+this.affectedExpData.EqPanelId
this.$(".plg-eqn-popup-label").html(this.model.EqPanelData[this.affectedExpData.EqPanelId].title+" - "+this.langJson.eq_seg_text+(Object.keys(this.model.EqPanelData[this.affectedExpData.EqPanelId].lineData).indexOf(this.affectedExpData.LineId)+1)),this.$(".plg-eqn-popup-label").removeClass().addClass(e),this.setDefaultsToSpinners(this.affectedExpData),this.setInterceptType(this.affectedExpData),this.setRangeRelation(this.affectedExpData),this.bIsVisible&&!this.bIsPopupAlreadyOpen&&(this.showPopup(!0),null!==this.accManager&&this.accManager.isAccessibilityOn||(this.bIsPopupAlreadyOpen=!0))},changeSIspinnerSlope:function(){this.model.EquationExpressionChange({expType:"SIspinnerSlope",curValue:this.si_spinner_slope.currentValue,affectedExpData:this.affectedExpData})},changeSIspinnerDisplacement:function(){this.model.EquationExpressionChange({expType:"SIspinnerDisplacement",curValue:this.si_spinner_displacement.currentValue,affectedExpData:this.affectedExpData})},changeSIspinnerX1:function(){this.model.EquationExpressionChange({expType:"SIspinnerX1",curValue:this.si_spinner_x1.currentValue,affectedExpData:this.affectedExpData})},changeSIspinnerX2:function(){this.model.EquationExpressionChange({expType:"SIspinnerX2",curValue:this.si_spinner_x2.currentValue,affectedExpData:this.affectedExpData})},changePSspinnerSlope:function(){this.model.EquationExpressionChange({expType:"PSspinnerSlope",curValue:this.ps_spinner_slope.currentValue,affectedExpData:this.affectedExpData})},changePSspinnerX1A:function(){this.model.EquationExpressionChange({expType:"PSspinnerX1A",curValue:this.ps_spinner_x1_a.currentValue,affectedExpData:this.affectedExpData})},changePSspinnerY1:function(){this.model.EquationExpressionChange({expType:"PSspinnerY1",curValue:this.ps_spinner_y1.currentValue,affectedExpData:this.affectedExpData})},changePSspinnerX1B:function(){this.model.EquationExpressionChange({expType:"PSspinnerX1B",curValue:this.ps_spinner_x1_b.currentValue,affectedExpData:this.affectedExpData})},changePSspinnerX2:function(){this.model.EquationExpressionChange({expType:"PSspinnerX2",curValue:this.ps_spinner_x2.currentValue,affectedExpData:this.affectedExpData})},_attachEvents:function(){var e=this
this.$(".plg-eqn-popup-close").on("click",function(){e.showPopup(!1)})},showPopup:function(e){e?this.$(".plg-eqn-popup-container").show():this.$(".plg-eqn-popup-container").hide(),this.bIsVisible=e,this.model.PopupVisibilityChange({bIsVisible:e,popupName:"Eq Expression Popup",affectedExpData:this.affectedExpData})},createSpinner:function(e,n,t,s,i){var a={el:this.$("."+e),maxValue:this.spinnerMinValue,minValue:this.spinnerMaxValue,step:n,defaultValue:t,showSign:!0,isEditable:!1,spinId:s,inputPrecision:i}
return p.generateCustomSpinner(a)},setDefaultsToSpinners:function(e){var n=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].slope,t=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].displacement,p=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].x1,s=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].x2,i=p,a=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].y1,l=!1
bHideX2=!1,this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].lineTypeId===this.constants.NEG_INFINITY_RAY?(i=s,a=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].y2,l=!0):this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].lineTypeId===this.constants.POS_INFINITY_RAY&&(bHideX2=!0),this.updateSpinner(this.si_spinner_slope,n),this.updateSpinner(this.si_spinner_displacement,t),l?(this.$(".plg-eqn-popup-13").hide(),this.$(".plg-eqn-popup-24").hide(),this.$(".plg-eqn-popup-13-infinitytext").show(),this.$(".plg-eqn-popup-24-infinitytext").show()):(this.updateSpinner(this.si_spinner_x1,p),this.updateSpinner(this.ps_spinner_x1_b,p),this.$(".plg-eqn-popup-13").show(),this.$(".plg-eqn-popup-24").show(),this.$(".plg-eqn-popup-13-infinitytext").hide(),this.$(".plg-eqn-popup-24-infinitytext").hide()),bHideX2?(this.$(".plg-eqn-popup-14").hide(),this.$(".plg-eqn-popup-25").hide(),this.$(".plg-eqn-popup-14-infinitytext").show(),this.$(".plg-eqn-popup-25-infinitytext").show()):(this.updateSpinner(this.si_spinner_x2,s),this.updateSpinner(this.ps_spinner_x2,s),this.$(".plg-eqn-popup-14").show(),this.$(".plg-eqn-popup-25").show(),this.$(".plg-eqn-popup-14-infinitytext").hide(),this.$(".plg-eqn-popup-25-infinitytext").hide()),this.updateSpinner(this.ps_spinner_slope,n),this.updateSpinner(this.ps_spinner_x1_a,i),this.updateSpinner(this.ps_spinner_y1,a)},setInterceptType:function(e){var n=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].idInterceptType
this.$(".plg-eqn-popup-checkbox").removeClass("checked"),n===this.constants.SLOPE_INTERCEPT?this.$(".plg-eqn-popup-checkbox.one").addClass("checked"):this.$(".plg-eqn-popup-checkbox.two").addClass("checked")},setRangeRelation:function(e){var n=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].xRangeLeftRelation,t=this.model.EqPanelData[e.EqPanelId].lineData[e.LineId].xRangeRightRelation
n===this.constants.LESS_THAN_OR_EQUAL?(this.$("#plg-eqn-popup-toggle-btn-less-than-equal-one").addClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-one").removeClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-than-equal-three").addClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-three").removeClass("plg-eqn-popup-toggle-checked")):(this.$("#plg-eqn-popup-toggle-btn-less-than-equal-one").removeClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-one").addClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-than-equal-three").removeClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-three").addClass("plg-eqn-popup-toggle-checked")),t===this.constants.LESS_THAN_OR_EQUAL?(this.$("#plg-eqn-popup-toggle-btn-less-than-equal-two").addClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-two").removeClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-than-equal-four").addClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-four").removeClass("plg-eqn-popup-toggle-checked")):(this.$("#plg-eqn-popup-toggle-btn-less-than-equal-two").removeClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-two").addClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-than-equal-four").removeClass("plg-eqn-popup-toggle-checked"),this.$("#plg-eqn-popup-toggle-btn-less-four").addClass("plg-eqn-popup-toggle-checked"))},updateSpinner:function(e,n){e.updateSpinValue(n,!1,!0)}})
return s})
