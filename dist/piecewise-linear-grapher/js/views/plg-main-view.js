define(["base-interactive-view","main-model","lang-json","graph-view","equation-panel-view","equation-popup-view","acc-manager-view","equation-about-view","save-image-view","equation-axis-label-view","equation-error-msg-view","equation-save-msg-view","constants","plg-template"],function(e,t,i,a,n,s,l,c,o,h,r,d,p){var g=e.extend({initialize:function(){this.model=new t,this.constants=new p,this.langJson=i,this.$activity_el=null,this.oGrapher=null,this.oEqPanel1=null,this.oEqPanel2=null,this.oEqPanel3=null,this.oEqPanel4=null,this.accManager=null,this.isAccessibilityOn=!0,this.accJson=i.accJSON,this.accManager=null,this.oAboutPopup=null,this.oSaveImageView=null,this.oAxisLabelView=null,this.oErrorMsgView=null,this.oSaveMsgView=null,this.graphLabelAccText="",this.deleteBtnAccText="",this.lineSegAcctext="",this.linePosRayAcctext="",this.lineNegRayAcctext="",this.isAccessibilityOn&&(this.accManager=new l({el:this.$el,isAccessibilityOn:this.isAccessibilityOn})),this.listenTo(this.model,"lineVisibilityChanged",this.onLineVisibilityChange),this.listenTo(this.model,"OnPopupVisibilityChange",this.OnPopupVisibilityChange),this.listenTo(this.model,"OnGraphScale",this.setSliderProps),this.listenTo(this.model,"changeEquationSelection",this.changeEquationSelection),this.listenTo(this.model,"OnLineDatachange",this.OnLineDatachange),this.listenTo(this.model,"OnDeselectLine",this.OnDeselectLine),this.listenTo(this.model,"updateAccText",this.updateAccText),this.listenTo(this.model,"onSelectLine",this.onSelectLine)},onSelectLine:function(){this.$("#plg-obj-oval-background-one").removeClass("plg-selected-modelObject"),this.$("#plg-obj-oval-background-two").removeClass("plg-selected-modelObject"),this.$("#plg-obj-oval-background-three").removeClass("plg-selected-modelObject"),this.$("#plg-obj-oval-background-four").removeClass("plg-selected-modelObject"),this.$("#plg-obj-oval-background-"+this.model.idSelectedEqPanel).addClass("plg-selected-modelObject")},OnDeselectLine:function(){null!=this.accManager&&this.accManager.isAccessibilityOn&&this.accManager.setAccText(this.$("#plg-graph-button-close"),"Delete selected ray or line button. Currently, no line is selected.",null)},updateAccText:function(){null!=this.accManager&&this.accManager.isAccessibilityOn&&this.accManager.setAccText(this.$("#plg-graph-label-container"),this.graphLabelAccText,this.graphLabelPosition())},OnLineDatachange:function(){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var e=this.getDeleteBtnAccText()
null!==e?this.accManager.setAccText(this.$("#plg-graph-button-close"),this.deleteBtnAccText,e):this.accManager.setAccText(this.$("#plg-graph-button-close"),"Delete selected ray or line button. Currently, no line is selected.",null),this.accManager.setAccText(this.$("#plg-line-segment"),this.lineSegAcctext,this.getlineAccparam(this.constants.SEGMENT)),this.accManager.setAccText(this.$("#plg-positive-infinity"),this.linePosRayAcctext,this.getlineAccparam(this.constants.POS_INFINITY_RAY)),this.accManager.setAccText(this.$("#plg-negative-infinity"),this.lineNegRayAcctext,this.getlineAccparam(this.constants.NEG_INFINITY_RAY)),this.accManager.setAccText(this.$("#plg-graph-label-container"),this.graphLabelAccText,this.graphLabelPosition())}},changeEquationSelection:function(e){null!=this.accManager&&this.accManager.isAccessibilityOn&&(this.accManager.setAccText(this.$("#plg-graph-label-container"),this.graphLabelAccText,this.graphLabelPosition()),this.accManager.setAccText(this.$("#plg-graph-button-close"),this.deleteBtnAccText,this.getDeleteBtnAccText()))},getDeleteBtnAccText:function(){var e="No line",t="one"
return this.model.idSelectedEqPanel!==this.constants.INVALID_VALUE&&this.model.EqPanelData[this.model.idSelectedEqPanel].idSelectedLine!=this.constants.INVALID_VALUE?(e="line "+(Object.keys(this.model.EqPanelData[this.model.idSelectedEqPanel].lineData).indexOf(this.model.EqPanelData[this.model.idSelectedEqPanel].idSelectedLine)+1),t=this.model.idSelectedEqPanel,[e,t]):null},events:{"click #plg-vertical-increase-button":"verticalIncreaseGraph","click #plg-vertical-decrease-button":"verticalDecreaseGraph","click #plg-vertical-default-button":"verticalDefaultGraph","click #plg-horizontal-increase-button":"horizontalIncreaseGraph","click #plg-horizontal-decrease-button":"horizontalDecreaseGraph","click #plg-horizontal-default-button":"horizontalDefaultGraph","click #plg-line-segment":"createLineSegment","click #plg-positive-infinity":"createPositiveInfinityRay","click #plg-negative-infinity":"createNegativeInfinityRay","click #plg-spinner-btn-up-arrow":"spinImageUp","click #plg-spinner-btn-down-arrow":"spinImageDown","slidechange #plg-slider":"sliderThumbPositionChange","slide #plg-slider":"sliderThumbPositionChange","click .pbs-base-title-i-icon-content":"showAboutPage","click .pbs-base-title-cam-icon-content":"showSaveImagePopup","click #plg-graph-button-pencil":"showAxisLabelPopup","click #plg-graph-button-close":"removeExpressionLine","keyup #plg-btn-spinner":"modelSpinnerUpDownKey"},modelSpinnerUpDownKey:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var t=e.keyCode||e.which
38===t?this.spinImageUp():40===t&&this.spinImageDown()}},onLineVisibilityChange:function(e){null!==this.accManager&&this.accManager.isAccessibilityOn&&this.accManager.setAccText(this.$("#plg-graph-label-container"),this.graphLabelAccText,this.graphLabelPosition(e.affectedEqPanelId))},lineSegmentUpdatedLabel:function(){if(null!=this.accManager&&this.accManager.isAccessibilityOn)for(var e,t,i=this.accJson.length,a=0,n=["No Function panel selected. Please select a function panel first."];i>a;a++)if(e=this.accJson[a],"#plg-line-segment"===e.id){-1!==this.model.idSelectedEqPanel&&(t="Use spacebar to create a line segment on the graph for the function panel "+this.model.EqPanelData[this.model.idSelectedEqPanel].idEquationPanel+".",n=[t]),this.accManager.setAccText(this.$(e.id),e.accText,n)
break}},positiveRayUpdatedLabel:function(){if(null!=this.accManager&&this.accManager.isAccessibilityOn)for(var e,t,i=this.accJson.length,a=0,n=["No Function panel selected. Please select a function panel first."];i>a;a++)if(e=this.accJson[a],"#plg-positive-infinity"===e.id){"#plg-line-segment"===e.id&&(t="Use spacebar to create a ray approaching positive infinity on the graph for the function panel "+this.model.EqPanelData[this.model.idSelectedEqPanel].idEquationPanel+".",n=[t]),this.accManager.setAccText(this.$(e.id),e.accText,n)
break}},negativeRayUpdatedLabel:function(){if(null!=this.accManager&&this.accManager.isAccessibilityOn)for(var e,t,i,a=this.accJson.length,n=0;a>n;n++)if(e=this.accJson[n],"#plg-negative-infinity"===e.id){i="Use spacebar to create a ray approaching negative infinity on the graph for the function panel "+this.model.EqPanelData[this.model.idSelectedEqPanel].idEquationPanel+".",t=[i],this.accManager.setAccText(this.$(e.id),e.accText,t)
break}},removeExpressionLine:function(e){var t=this.model,i=t.selectedLine,a=t.idSelectedEqPanel
this.model.EqPanelData
i&&!$(e.target).hasClass("plg-eqn-popup-close")&&-1!==a&&(this.model.DeleteLine({EqPanelId:a,LineId:i.lineId}),this.model.SetEqPanelSelected({EqPanelId:a}))},showErrorMsgPopup:function(){this.oErrorMsgView.showErrorMsgPopup(!0)},showAxisLabelPopup:function(){this.oAxisLabelView.showAxisLabelPopup(!0)},showSaveMsgPopup:function(){this.oSaveMsgView.showSaveMsgPopup(!0)},showSaveImagePopup:function(){this.oSaveImageView.showSavePage(!0)},showAboutPage:function(){this.oAboutPopup.showAboutPage(!0)},sliderThumbPositionChange:function(e){if("slide"===e.type||"slidechange"===e.type){var t
if(t="slide"===e.type||e.originalEvent?Number(this.$("#plg-slider").slider("value").toFixed(1)):this.model.sliderValue,("slide"===e.type||e.originalEvent)&&this.model.AddSliderPointOnLine({xPos:t},!0),null!=this.accManager&&this.accManager.isAccessibilityOn){for(var i,a,n=this.accJson.length,s=0;n>s;s++)if(i=this.accJson[s],".ui-slider-handle"===i.id){var l=t,c="The slider handle is now at "+l
a=[c],this.accManager.setAccText(this.$(i.id),i.accText,a)
break}this.accManager.setAccText(this.$("#plg-graph-label-container"),this.graphLabelAccText,this.graphLabelPosition())}}},spinImageUp:function(){this.model.ShowNextImage(),this.$("#plg-img-obj").css("background-position",-40*this.model.idSelectedModelObj+"px 0px"),this.$(".plg-obj-image").css("background-position",-56*this.model.idSelectedModelObj+"px 0px"),this.changeSpinnerAcc()},spinImageDown:function(){this.model.ShowPreviousImage(),this.$("#plg-img-obj").css("background-position",-40*this.model.idSelectedModelObj+"px 0px"),this.$(".plg-obj-image").css("background-position",-1*this.model.idSelectedModelObj*this.$(".plg-obj-image").width()+"px 0px"),this.changeSpinnerAcc()},changeSpinnerAcc:function(){if(null!=this.accManager&&this.accManager.isAccessibilityOn)for(var e,t,i=this.accJson.length,a=0;i>a;a++)if(e=this.accJson[a],"#plg-btn-spinner"===e.id){var n=this.spinCurrentModelObject(),s=n
t=[s],this.accManager.setAccText(this.$(e.id),e.accText,t)
break}},verticalIncreaseGraph:function(){this.model.scaleGraph("YPlus")},verticalDecreaseGraph:function(){this.model.scaleGraph("YMinus")},verticalDefaultGraph:function(){this.model.scaleGraph("resetY")},horizontalIncreaseGraph:function(){this.model.scaleGraph("XPlus")},horizontalDecreaseGraph:function(){this.model.scaleGraph("XMinus")},horizontalDefaultGraph:function(){this.model.scaleGraph("resetX")},createLineSegment:function(){this.model.AddLineSegment()},createPositiveInfinityRay:function(){this.model.AddPositiveInfinityRay()},createNegativeInfinityRay:function(){this.model.AddNegativeInfinityRay()},OnModelObjectChange:function(){},graphLabelPosition:function(e){var t="",i="",a="",n="",s="",l=null
return this.$("#plg-obj-oval-background-one").is(":visible")&&(t="The y position of function panel one is "+this.model.EqPanelData.one.ySliderPointPos.safe_toFixed(1)+"."),this.$("#plg-obj-oval-background-two").is(":visible")&&(i="The y position of function panel two is "+this.model.EqPanelData.two.ySliderPointPos.safe_toFixed(1)+"."),this.$("#plg-obj-oval-background-three").is(":visible")&&(a="The y position of function panel three is "+this.model.EqPanelData.three.ySliderPointPos.safe_toFixed(1)+"."),this.$("#plg-obj-oval-background-four").is(":visible")&&(n="The y position of function panel four is "+this.model.EqPanelData.four.ySliderPointPos.safe_toFixed(1)+"."),l=[t,i,a,n],e&&(this.$("#plg-obj-oval-background-"+e).is(":visible")||(s="The y position of function panel "+e+" is "+this.model.EqPanelData[e].ySliderPointPos.safe_toFixed(1)+"."),"one"===e?l[0]=s:"two"===e?l[1]=s:"three"===e?l[2]=s:"four"===e&&(l[3]=s)),l},spinCurrentModelObject:function(){var e=this.model.idSelectedModelObj,t="",i=null
return 0===e?t="rocket ":1===e?t="basketball ":2===e?t="monkey":3===e?t="dollar ":4===e&&(t="dolphin "),i=[t]},equationPanelUpdate:function(){var e=this.model.EqPanelData[this.model.idSelectedEqPanel]
return strPanelNo=e.idEquationPanel,strLineNo=e.idSelectedLine,strFunc="functions",arrParam=null,strLineNo=strLineNo.slice(-1),1==strLineNo&&(strFunc="function"),arrParam=[strPanelNo,strLineNo,strFunc],arrParam},setAccOn:function(){for(var e,t=this.accJson.length,i=0;t>i;i++){e=this.accJson[i],this.accManager.setTabIndex(this.$(e.id),e.tabIndex)
var a=null
if("#plg-graph-label-container"===e.id)this.graphLabelAccText=e.accText,a=this.graphLabelPosition()
else{if("#plg-grapher-control"===e.id){this.oGrapher.updateGraphAcc(e.accText)
continue}if("#plg-btn-spinner"===e.id){var n=this.spinCurrentModelObject(),s=n
a=[s]}else if(".ui-slider-handle"===e.id){var l=this.model.EqPanelData[this.model.idSelectedEqPanel].xSliderPointPos,c="Currently the slider handle is at "+l+". Use the left and right arrow keys to move the slider handle"
a=[c]}else if("#plg-line-segment"===e.id)this.lineSegAcctext=e.accText,a=this.getlineAccparam(this.constants.SEGMENT)
else if("#plg-positive-infinity"===e.id)this.linePosRayAcctext=e.accText,a=this.getlineAccparam(this.constants.POS_INFINITY_RAY)
else if("#plg-negative-infinity"===e.id)this.lineNegRayAcctext=e.accText,a=this.getlineAccparam(this.constants.NEG_INFINITY_RAY)
else{if("#plg-equation-panel-one"===e.id){this.oEqPanel1.updateEqPanelAcc(e.accText)
continue}if("#plg-fa-check-square-one"===e.id){this.oEqPanel1.updateEqPanelCheckAcc(e.accText)
continue}if("#plg-txteditable-one"===e.id){this.oEqPanel1.updateEqPanelEditAcc(e.accText)
continue}if("#plg-equation-panel-two"===e.id){this.oEqPanel2.updateEqPanelAcc(e.accText)
continue}if("#plg-fa-check-square-two"===e.id){this.oEqPanel2.updateEqPanelCheckAcc(e.accText)
continue}if("#plg-txteditable-two"===e.id){this.oEqPanel2.updateEqPanelEditAcc(e.accText)
continue}if("#plg-equation-panel-three"===e.id){this.oEqPanel3.updateEqPanelAcc(e.accText)
continue}if("#plg-fa-check-square-three"===e.id){this.oEqPanel3.updateEqPanelCheckAcc(e.accText)
continue}if("#plg-txteditable-three"===e.id){this.oEqPanel3.updateEqPanelEditAcc(e.accText)
continue}if("#plg-equation-panel-four"===e.id){this.oEqPanel4.updateEqPanelAcc(e.accText)
continue}if("#plg-fa-check-square-four"===e.id){this.oEqPanel4.updateEqPanelCheckAcc(e.accText)
continue}if("#plg-txteditable-four"===e.id){this.oEqPanel4.updateEqPanelEditAcc(e.accText)
continue}"#plg-graph-button-close"===e.id&&(this.deleteBtnAccText=e.accText,a=this.getDeleteBtnAccText())}}this.accManager.setAccText(this.$(e.id),e.accText,a)}this.$(".acc-element").on("keydown",_.bind(this.accManager._keyPressHandler,this)),this.oGrapher.setAccOn(),this.oEqPanel1.setAccOn(),this.oEqPanel2.setAccOn(),this.oEqPanel3.setAccOn(),this.oEqPanel4.setAccOn()},getlineAccparam:function(e){var t=null
return e===this.constants.SEGMENT?t=-1!=this.model.idSelectedEqPanel?["Add Segment button. Use spacebar to create a line segment on the graph for the function panel "+this.model.idSelectedEqPanel]:["Add Segment button. Since no function panel selected, you can not add a segment."]:e===this.constants.POS_INFINITY_RAY?t=-1!=this.model.idSelectedEqPanel?["Add positive ray button. Use spacebar to create a ray approaching positive infinity on the graph for the function panel "+this.model.idSelectedEqPanel]:["Add positive ray button. Since no function panel selected, you can not add a ray."]:e===this.constants.NEG_INFINITY_RAY&&(t=-1!=this.model.idSelectedEqPanel?["Add negative ray button. Use spacebar to create a ray approaching negative infinity on the graph for the function panel "+this.model.idSelectedEqPanel]:["Add negative ray button. Since no function panel selected, you can not add a ray."]),t},OnPopupVisibilityChange:function(e){null!=this.accManager&&this.accManager.isAccessibilityOn&&(e.bIsVisible?this.accManager.disableAllTabs():(this.accManager.enableAllTabs(),"About Popup"===e.popupName?this.$("#pbs-base-title-i-icon-content").focus():"Axis Label Popup"===e.popupName?this.$("#plg-graph-button-pencil").focus():"Error Msg Popup"===e.popupName?this.$(".ui-slider-handle").focus():("Save Popup"===e.popupName||"Save Msg Popup"===e.popupName)&&(e.affectedExpData&&e.affectedExpData.bSaveOkClicked||this.$("#pbs-base-title-cam-icon-content").focus()))),"Save Popup"===e.popupName&&e.affectedExpData&&e.affectedExpData.bSaveOkClicked&&(Shutterbug.snapshot({selector:"#plg-main-container",done:this.ScreenshotDone,fail:this.ScreenshotFail,always:this.ScreenshotAlways}),this.oSaveMsgView.showSaveMsgPopup(!0),g_oSaveMsgView=this.oSaveMsgView)},ScreenshotDone:function(e){e&&g_oSaveMsgView&&g_oSaveMsgView.updateURL(e)},ScreenshotFail:function(){alert("Image save failed. Please check your internet connection and retry.")},ScreenshotAlways:function(){},setSliderProps:function(){this.$("#plg-slider").slider({value:this.model.sliderValue,min:this.model.gridOptions.gridLimits.xLower,max:this.model.gridOptions.gridLimits.xUpper,step:.1})},renderActivityArea:function(){null===this.$activity_el&&(this.$activity_el=this.$("#"+this.langJson.title_short+"-activity-area-container"))
var e=Handlebars.templates["plg-template"]({"activity-json":this.langJson}).trim()
if(this.$activity_el.append(e),this.$(".plg-obj-oval-background").hide(),this.$("#plg-slider").slider({value:1,min:this.model.gridOptions.gridLimits.xLower,max:this.model.gridOptions.gridLimits.xUpper,step:.1}),null===this.oGrapher&&null===this.oEqPanel1){this.oEqPopup=new s({el:this.$("#plg-activity-area-container"),model:this.model,accManager:this.accManager}),this.oAboutPopup=new c({el:this.$("#plg-activity-area-container"),model:this.model,accManager:this.accManager}),this.oSaveImageView=new o({el:this.$("#plg-activity-area-container"),model:this.model,accManager:this.accManager}),this.oAxisLabelView=new h({el:this.$("#plg-activity-area-container"),model:this.model,accManager:this.accManager}),this.oErrorMsgView=new r({el:this.$("#plg-activity-area-container"),model:this.model,accManager:this.accManager}),this.oSaveMsgView=new d({el:this.$("#plg-activity-area-container"),model:this.model,accManager:this.accManager})
var t=this.$("#plg-grapher-control")
this.model.updateGraphCoord(t.height(),t.width()),this.oGrapher=new a({el:t,model:this.model,accManager:this.accManager}),this.oEqPanel1=new n({el:this.$("#plg-equation-panel-one"),model:{number:"1",arrayId:"one",mainModel:this.model,cssClassName:"plg-equation-panel-one",oEqPopup:this.oEqPopup,accManager:this.accManager}}),this.oEqPanel2=new n({el:this.$("#plg-equation-panel-two"),model:{number:"2",arrayId:"two",mainModel:this.model,cssClassName:"plg-equation-panel-two",oEqPopup:this.oEqPopup,accManager:this.accManager}}),this.oEqPanel3=new n({el:this.$("#plg-equation-panel-three"),model:{number:"3",arrayId:"three",mainModel:this.model,cssClassName:"plg-equation-panel-three",oEqPopup:this.oEqPopup,accManager:this.accManager}}),this.oEqPanel4=new n({el:this.$("#plg-equation-panel-four"),model:{number:"4",arrayId:"four",mainModel:this.model,cssClassName:"plg-equation-panel-four",oEqPopup:this.oEqPopup,accManager:this.accManager}})}this.oGrapher.render(),this.oEqPanel1.render(),this.oEqPanel2.render(),this.oEqPanel3.render(),this.oEqPanel4.render(),null!=this.accManager&&this.accManager.isAccessibilityOn&&(this.setAccOn(),this.$("#plg-main-container").focus())}})
return g})
