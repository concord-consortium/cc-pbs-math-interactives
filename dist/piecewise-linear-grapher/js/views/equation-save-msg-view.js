define(["equation-save-msg-template","lang-json"],function(e,s){var i=Backbone.View.extend({initialize:function(e){this.listenTo(this.model,"OnPopupVisibilityChange",this.OnPopupVisibilityChange),this.accManager=e.accManager,this.bIsVisible=!1,this.bIsPopupAlreadyOpen=!1,this.langJson=s.saveimagemsgpopupJSON,this.accJson=s.saveimagemsgpopupAccJSON,this.holderAccText="",this.popupName="Save Msg Popup",this.holderDiv=null,this.urlAccText="",this.render()},render:function(){var e=Handlebars.templates["equation-save-msg-template"]({}).trim()
this.$el.append(e),this.$("#plg-save-msg-popup-exp").html(this.langJson.title),this.$("#plg-img-saved-msg").html(this.langJson.msg),this.holderDiv=this.$("#plg-save-msg-popup-holder"),this._attachEvents(),this.showSaveMsgPopup(!1)},events:{"keyup #plg-equation-save-msg-panel":"popupHolderKeyup"},popupHolderKeyup:function(e){if(null!=this.accManager&&this.accManager.isAccessibilityOn){var s=e.keyCode||e.which
27===s&&this.showSaveMsgPopup(!1)}},_attachEvents:function(){var e=this
this.$(".plg-save-msg-popup-close-exp").on("click",function(){e.showSaveMsgPopup(!1)})},showSaveMsgPopup:function(e){e?(this.$(".plg-equation-save-msg-panel").show(),this.$("#plg-img-saved-msg").hide(),this.$("#plg-progress-msg").show(),this.$("#plg-saved-url").hide()):this.$(".plg-equation-save-msg-panel").hide(),this.bIsVisible=e,this.model.PopupVisibilityChange({bIsVisible:e,popupName:this.popupName,affectedExpData:null})},updateURL:function(e){var s=this.$("#plg-saved-url-a"),i=this.$("#plg-img-saved-msg")
if(s.html(e),s.attr("href",e),i.show(),this.$("#plg-progress-msg").hide(),this.$("#plg-saved-url").show(),null!=this.accManager&&this.accManager.isAccessibilityOn){var t=[i.text()+" Press Tab to visit to the image URL."]
this.accManager.enableTab(s,!0),this.accManager.setAccText(s,this.urlAccText,[e]),s.off("keyup").on("keyup",function(e){var s=e?e.which:e.keyCode,i=13,t=32;(s===t||s===i)&&window.open(e.currentTarget.href)}),this.accManager.setAccText(this.holderDiv,this.holderAccText,t),$("#Dummy").attr("tabindex","1000").focus().removeAttr("tabindex"),this.holderDiv.focus()}},OnPopupVisibilityChange:function(e){e.popupName===this.popupName&&(null!=this.accManager&&this.accManager.isAccessibilityOn&&(e.bIsVisible?(this.setAccOn(),this.holderDiv.focus()):this.setAccOff()),e.bIsVisible||(this.bIsPopupAlreadyOpen=!1))},setAccOn:function(){for(var e,s=this.accJson.length,i=0,t=null;s>i;i++)e=this.accJson[i],this.accManager.setTabIndex(this.$(e.id),e.tabIndex),t=null,"#plg-save-msg-popup-holder"===e.id?(this.holderAccText=e.accText,t=["Please wait while image is been saved or"]):"#plg-saved-url-a"===e.id&&(this.urlAccText=e.accText),this.accManager.setAccText(this.$(e.id),e.accText,t)
this.accManager.enableTab(this.$("#plg-saved-url-a"),!1)},setAccOff:function(){for(var e,s=this.accJson.length,i=0;s>i;i++)e=this.accJson[i],this.accManager.setTabIndex(this.$(e.id),-1),this.accManager.setAccText(this.$(e.id),"",null)
this.$(".acc-element").on("keydown",_.bind(this.accManager._keyPressHandler,this))}})
return i})
